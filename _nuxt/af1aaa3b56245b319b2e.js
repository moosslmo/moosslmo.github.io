(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{698:function(e,t,r){var content=r(705);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(106).default)("72541fd0",content,!0,{sourceMap:!1})},704:function(e,t,r){"use strict";var n=r(698);r.n(n).a},705:function(e,t,r){(e.exports=r(105)(!1)).push([e.i,".user[data-v-141c844f]{display:grid}.user__message[data-v-141c844f]{position:absolute;display:inline-block;-webkit-transform-origin:bottom center;transform-origin:bottom center;-webkit-transform:translateX(-50%) translateY(calc(-100% - 58px));transform:translateX(-50%) translateY(calc(-100% - 58px));background-color:#ddd;border-radius:8px;padding:4px 8px;max-width:150px}.user__message.new[data-v-141c844f]{-webkit-animation:popup-data-v-141c844f .15s cubic-bezier(.175,.885,.32,1.275);animation:popup-data-v-141c844f .15s cubic-bezier(.175,.885,.32,1.275)}.user__avatar[data-v-141c844f]{position:absolute;cursor:none;border-radius:100%}.user__name[data-v-141c844f]{position:absolute;-webkit-transform:translateX(-50%) translateY(55px);transform:translateX(-50%) translateY(55px)}@-webkit-keyframes popup-data-v-141c844f{0%{-webkit-transform:scale(0) translateX(-50%) translateY(calc(-100% - 58px));transform:scale(0) translateX(-50%) translateY(calc(-100% - 58px))}to{-webkit-transform:scale(1) translateX(-50%) translateY(calc(-100% - 58px));transform:scale(1) translateX(-50%) translateY(calc(-100% - 58px))}}@keyframes popup-data-v-141c844f{0%{-webkit-transform:scale(0) translateX(-50%) translateY(calc(-100% - 58px));transform:scale(0) translateX(-50%) translateY(calc(-100% - 58px))}to{-webkit-transform:scale(1) translateX(-50%) translateY(calc(-100% - 58px));transform:scale(1) translateX(-50%) translateY(calc(-100% - 58px))}}",""])},712:function(e,t,r){"use strict";var n={props:["message","x","y","avatar","name","face","isFace"],data:function(){return{width:100}},watch:{message:function(e){var t=this;this.$refs.message&&this.$refs.message.classList.add("new"),setTimeout(function(){return t.$refs.message.classList.remove("new")},150)}}},c=(r(704),r(70));Object(c.a)(n,function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"user"},[e.message?r("div",{ref:"message",staticClass:"user__message",style:{left:e.x+"px",top:e.y+"px"}},[e._v("\n    "+e._s(e.message)+"\n  ")]):e._e(),e._v(" "),r("img",{staticClass:"user__avatar",style:{left:e.x-e.width/2+"px",top:e.y-e.width/2+"px"},attrs:{src:e.isFace?e.face:e.avatar,width:e.width}}),e._v(" "),r("div",{staticClass:"user__name",style:{left:e.x+"px",top:e.y+"px"}},[e._v("\n    "+e._s(e.name)+"\n  ")])])},[],!1,null,"141c844f",null).exports},732:function(e,t,r){var content=r(860);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(106).default)("48f36674",content,!0,{sourceMap:!1})},776:function(e,t){},778:function(e,t){},810:function(e,t){},811:function(e,t){},859:function(e,t,r){"use strict";var n=r(732);r.n(n).a},860:function(e,t,r){(e.exports=r(105)(!1)).push([e.i,".container[data-v-5a318c68]{height:100%;width:100%;cursor:none}.container .camera[data-v-5a318c68]{width:200px}.container .camera canvas[data-v-5a318c68]{display:block;border-radius:100%}.container .camera video[data-v-5a318c68]{display:block;position:absolute;background-color:rgba(0,0,0,.1);visibility:hidden}.container .other__face[data-v-5a318c68]{display:inline-block;border-radius:100%;width:100px;height:100px}@-webkit-keyframes popup-data-v-5a318c68{0%{-webkit-transform:scale(0);transform:scale(0)}to{-webkit-transform:scale(1);transform:scale(1)}}@keyframes popup-data-v-5a318c68{0%{-webkit-transform:scale(0);transform:scale(0)}to{-webkit-transform:scale(1);transform:scale(1)}}@-webkit-keyframes popdown-data-v-5a318c68{0%{-webkit-transform:scale(1);transform:scale(1)}to{-webkit-transform:scale(0);transform:scale(0)}}@keyframes popdown-data-v-5a318c68{0%{-webkit-transform:scale(1);transform:scale(1)}to{-webkit-transform:scale(0);transform:scale(0)}}",""])},870:function(e,t,r){"use strict";r.r(t);r(425),r(426),r(88);var n=r(48),c=(r(146),r(35)),o=r(148),f=(r(712),r(868)),main=r(147),l={data:function(){return{user:null,uid:null,me:null,inputText:"",isInputFocus:!1,isFace:!1,timer:null}},firebase:function(){return{users:o.a.ref("users")}},created:function(){var e=Object(c.a)(regeneratorRuntime.mark(function e(){var t,r,f=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o.b.auth().onAuthStateChanged(function(e){e&&(console.log(e),f.user=e,f.uid=e.uid,f.me=Object(n.a)({},f.me,{avatar:e.photoURL,name:e.displayName||e.email.substring(0,e.email.lastIndexOf("@")),x:100,y:100}),o.a.ref("users/".concat(f.uid)).set(f.me))}),e.next=4,o.a.ref("users").push({name:Math.random().toString(),score:0});case 4:t=e.sent,r=t.key,this.key=r,window.addEventListener("beforeunload",function(e){Object(main.clearInterval)(f.timer),o.a.ref("users/".concat(r)).set({})}),window.addEventListener("keypress",function(e){if(13===e.keyCode&&f.me)if(f.isInputFocus){if(f.isInputFocus=!1,e.target.blur(),""===f.inputText)return;f.me=Object(n.a)({},f.me,{message:f.inputText}),o.a.ref("users/".concat(f.uid,"/message")).set(f.inputText),o.a.ref("messages").push().set(f.inputText),f.inputText=""}else f.inputText="",f.$refs.input.focus(),f.isInputFocus=!0}),window.addEventListener("keypress",function(){var e=Object(c.a)(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(116!==t.keyCode&&12613!==t.keyCode||f.isInputFocus)){e.next=2;break}return e.abrupt("return");case 2:f.isFace?(f.isFace=!1,f.me=Object(n.a)({},f.me,{isFace:f.isFace}),o.a.ref("users/".concat(f.uid)).set(f.me),Object(main.clearInterval)(f.timer)):(f.cameraOn(),f.isFace=!0,f.timer=setInterval(function(){(void 0).detect(f.$refs.video).then(function(e){if(e[0]){var t=e[0].boundingBox,r=t.x,c=t.y,l=t.width,m=t.height,d=l/3;f.$refs.canvas.getContext("2d").drawImage(f.$refs.video,r-d,c-d,l+2*d,m+2*d,0,0,100,100);var base=f.$refs.canvas.toDataURL("image/jpeg",.5);f.me=Object(n.a)({},f.me,{face:base,isFace:f.isFace}),o.a.ref("users/".concat(f.uid)).set(f.me)}})},100));case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 10:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),mounted:function(){var e=Object(c.a)(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.c.tinyFaceDetector.loadFromUri("/models");case 2:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),methods:{mousemove:function(e){(this.user||this.uid)&&(this.me=Object(n.a)({},this.me,{x:e.pageX,y:e.pageY}),o.a.ref("users/".concat(this.uid)).set(this.me))},clickOutside:function(e){this.isInputFocus=!1,e.target.blur()},login:function(){var e=Object(c.a)(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.b.auth().signInWithPopup(new o.b.auth.GithubAuthProvider);case 2:t=e.sent,this.user=t.user,this.uid=t.user.uid,this.me=Object(n.a)({},this.me,{avatar:t.user.photoURL,name:t.user.displayName||t.user.email.substring(0,t.user.email.lastIndexOf("@")),x:0,y:0}),o.a.ref("users/".concat(this.uid)).set(this.me);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),cameraOn:function(){var e=Object(c.a)(regeneratorRuntime.mark(function e(){var video,t,r=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return video=this.$refs.video,e.prev=1,e.next=4,navigator.mediaDevices.getUserMedia({audio:!1,video:!0});case 4:t=e.sent,t.getVideoTracks(),video.onloadedmetadata=function(e){return video.play()},video.srcObject=t,e.next=13;break;case 10:e.prev=10,e.t0=e.catch(1),console.log(e.t0);case 13:this.timer=setInterval(function(){r.detectFace()},16);case 14:case"end":return e.stop()}},e,this,[[1,10]])}));return function(){return e.apply(this,arguments)}}(),detectFace:function(){var e=Object(c.a)(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.b(this.$refs.video,new f.a({inputSize:224}));case 2:t=e.sent,console.log(t),t?this.setUserFace(t):console.log("Out of Camera");case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),setUserFace:function(){var e=Object(c.a)(regeneratorRuntime.mark(function e(t){var r,n,c,f,l,m,d,h,v;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=t.box,n=this.$refs.userFace,c=n.getContext("2d"),f=r.width/5,l=r.left-f,m=r.top-1.5*f,d=r.width+2*f,h=r.height+2*f,d>h&&(v=h-d,h=d,m+=v/2),console.log(d,h),c.drawImage(this.$refs.video,l,m,d,h,0,0,200,200),o.a.ref("users/".concat(this.key,"/faceImage")).set(n.toDataURL("image/jpeg",.3));case 12:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},computed:{userList:function(){var e=this;return this.users.filter(function(t){return t[".key"]!==e.key}).map(function(e){var t=Object(n.a)({},e);return delete t[".key"],t})}},components:{}},m=(r(859),r(70)),component=Object(m.a)(l,function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"container"},[t("a-button",{attrs:{type:"primary"},on:{click:this.cameraOn}},[this._v("Camera on")]),this._v(" "),t("div",{staticClass:"camera"},[t("video",{ref:"video",attrs:{autoplay:"",playsinline:"",width:"480",height:"360"}}),this._v(" "),t("canvas",{ref:"userFace",staticClass:"face",attrs:{width:"200",height:"200"}})]),this._v(" "),this._l(this.userList,function(e){return t("img",{key:e.name,staticClass:"other__face",attrs:{src:e.faceImage,width:"200",height:"200"}})})],2)},[],!1,null,"5a318c68",null);t.default=component.exports}}]);